<div *ngIf="canManageRole('USER')" class="task-creation card-panel">
  <h3 class="header">Create a New Task</h3>
  <p class="description">Fill out the details below to add a new task to your project.</p>

  <form (ngSubmit)="createTask(taskName.value, taskDescription.value, taskDeadline.value)">
    <!-- Task Name -->
    <div class="input-field">
      <label for="taskName">Task Name</label>
      <input #taskName id="taskName" type="text" class="validate" required placeholder="Enter task name">
    </div>

    <!-- Task Description -->
    <div class="input-field">
      <label for="taskDescription">Task Description</label>
      <textarea #taskDescription id="taskDescription" class="materialize-textarea validate" required placeholder="Describe the task"></textarea>
    </div>

    <!-- Task Deadline -->
    <div class="input-field">
      <label for="taskDeadline">Deadline</label>
      <input #taskDeadline id="taskDeadline" type="datetime-local" required>
    </div>

    <!-- Submit Button -->
    <button mat-raised-button type="submit" class="btn-primary">
      <i class="material-icons left">add_task</i> Create Task
    </button>
  </form>

  <!-- Task Selection -->
  <div class="task-list card-panel">
    <h3>Project Tasks</h3>

    <table class="task-table">
      <thead>
      <tr>
        <th>Task Name</th>
        <th>Status</th>
        <th>Deadline</th>
      </tr>
      </thead>
      <tbody>
      <ng-container *ngFor="let task of tasks">
        <!-- Main row -->
        <tr (click)="onTaskSelected(task)" [class.selected]="selectedTask?.id === task.id">
          <td>{{ task.name }}</td>
          <td>
            <span [ngClass]="{
              'status-pending': task.status === 'PENDING',
              'status-completed': task.status === 'COMPLETED',
              'status-in-progress': task.status === 'IN PROGRESS'
            }">
              {{ task.status }}
            </span>
          </td>
          <td>{{ task.deadline | date:'shortDate' }}</td>
        </tr>

        <!-- Expanded content row -->
        <tr class="expandable-row" *ngIf="selectedTask?.id === task.id">
          <td colspan="3">
            <app-tasklog [task]="selectedTask" [logs]="taskLogs"></app-tasklog>
          </td>
        </tr>
      </ng-container>
      </tbody>
    </table>
  </div>


  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    <i class="material-icons">error_outline</i> {{ errorMessage }}
  </div>
</div>

