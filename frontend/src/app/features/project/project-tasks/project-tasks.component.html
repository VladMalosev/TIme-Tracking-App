<div *ngIf="canManageRole('USER')" class="task-creation mat-elevation-z8">
  <h3 class="mat-headline-5">Create a New Task</h3>
  <p class="mat-body-1 description">Fill out the details below to add a new task to your project.</p>

  <form (ngSubmit)="createTask(taskName.value, taskDescription.value, taskDeadline.value)">
    <!-- Task Name -->
    <mat-form-field appearance="outline" class="input-field">
      <mat-label>Task Name</mat-label>
      <input #taskName matInput id="taskName" type="text" required placeholder="Enter task name">
    </mat-form-field>

    <!-- Task Description -->
    <mat-form-field appearance="outline" class="input-field">
      <mat-label>Task Description</mat-label>
      <textarea #taskDescription matInput id="taskDescription" required placeholder="Describe the task"></textarea>
    </mat-form-field>

    <!-- Task Deadline -->
    <mat-form-field appearance="outline" class="input-field">
      <mat-label>Deadline</mat-label>
      <input #taskDeadline matInput id="taskDeadline" type="datetime-local" required>
    </mat-form-field>

    <!-- Submit Button -->
    <button mat-raised-button type="submit" color="primary" class="btn-primary ">
      <mat-icon>add_task</mat-icon> Create Task
    </button>
  </form>

  <!-- Task Selection -->
  <div class="task-list mat-elevation-z8">
    <h3 class="mat-headline-5">Project Tasks</h3>

    <table class="task-table">
      <thead>
      <tr>
        <th>Task Name</th>
        <th>Status</th>
        <th>Assigned To</th>
        <th>Created By</th>
        <th>Deadline</th>
        <th>Created At</th>
      </tr>
      </thead>
      <tbody>
      <ng-container *ngFor="let task of tasks">
        <!-- Main row -->
        <tr (click)="onTaskSelected(task)" [class.selected]="selectedTask?.id === task.id">
          <td>{{ task.name }}</td>
          <td>
            <span [ngClass]="{
              'status-pending': task.status === 'PENDING',
              'status-completed': task.status === 'COMPLETED',
              'status-in-progress': task.status === 'IN_PROGRESS'
            }">
              {{ task.status }}
            </span>
          </td>
          <td>{{ task.assignedTo?.name || 'Unassigned' }}</td>
          <td>{{ task.createdBy?.name || 'System' }}</td>
          <td>{{ task.deadline | date:'shortDate' }}</td>
          <td>{{ task.createdAt | date:'shortDate' }}</td>
        </tr>

        <!-- Expanded content row -->
        <tr class="expandable-row" *ngIf="selectedTask?.id === task.id">
          <td colspan="6">
            <app-tasklog [task]="selectedTask" [logs]="taskLogs"></app-tasklog>
          </td>
        </tr>
      </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message mat-elevation-z1">
    <mat-icon>error_outline</mat-icon> {{ errorMessage }}
  </div>
</div>
